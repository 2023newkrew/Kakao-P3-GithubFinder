import sweetAlert from "../lib/sweetAlert";

export default class User {
  constructor() {
    this.userData = null;
    this.userRepository = null;
    this.username = null;
  }

  async fetchUserData(username) {
    // TODO : Bearer Token .env 파일로 빼내기
    this.userData = await (
      await fetch(`https://api.github.com/users/${username}`, {
        headers: {
          Authorization: "Bearer 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",
        },
      })
    ).json();

    // ! 유저의 정보가 확인되지 않았을 경우
    if (this.userData.message === "Not Found") return false;

    this.username = username;

    this.userRepository = await (
      await fetch(`https://api.github.com/users/${username}/repos`, {
        headers: {
          Authorization: "Bearer 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",
        },
      })
    ).json();

    // 최근 업데이트 순 정렬
    this.userRepository.sort((elementA, elementB) => {
      return new Date(elementB.updated_at).getTime() - new Date(elementA.updated_at).getTime();
    });

    return true;
  }

  getUserName() {
    return this.username;
  }

  getProfileAvatarURL() {
    return this.userData.avatar_url;
  }

  getFollowerCount() {
    return this.userData.followers;
  }

  getFollowingCount() {
    return this.userData.following;
  }

  getCompany() {
    return this.userData.company;
  }

  getEmail() {
    return this.userData.email;
  }

  getLocation() {
    return this.userData.location;
  }

  getMemberSince() {
    return this.userData.created_at;
  }

  getPublicRepoCount() {
    return this.userData.public_repos;
  }

  getPublicGistCount() {
    return this.userData.public_gists;
  }

  getGitHubURL() {
    return this.userData.url;
  }

  // TODO : 적절한 함수명 짓기
  getLatestRepos(number) {
    return this.userRepository.slice(0, number);
  }
}
